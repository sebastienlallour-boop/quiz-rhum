<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Rhum - Connaisseur</title>
    <style>
        /* Couleurs et Th√®me Rhum */
        :root {
            --primary: #d35400; /* Rhum Ambr√© */
            --secondary: #fdf2e9; /* Fond Clair */
            --dark: #2c3e50;
            --correct: #27ae60;
            --wrong: #c0392b;
            --barrel-brown: #8b4513; /* Brun de tonneau */
            --barrel-highlight: #a0522d;
        }

        /* 1. Visuel Global */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f6f7;
        }

        .quiz-container {
            background: white;
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
            padding: 30px;
            transition: all 0.3s ease-in-out;
            box-sizing: border-box; /* Assure que le padding n'augmente pas la taille totale */
        }

        /* 2. Styles de la Page d'Accueil */
        #welcome-area {
            text-align: center;
        }

        .welcome-title {
            color: var(--primary);
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: inline-block;
            padding-bottom: 5px;
        }

        /* Style pour l'image de distillerie */
        .distillery-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .welcome-description {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Styles du Quiz */
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        .header h1 { margin: 0; color: var(--dark); font-size: 1.5em;}
        
        /* Conteneur de la progression (Question # et Chrono) */
        .progress-bar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 1em; 
            font-weight: bold;
            color: var(--dark);
        }

        .question-progress-live { color: var(--primary); }
        .chrono-live { color: var(--dark); }


        .question-card { margin-bottom: 20px; }
        
        .question-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .question-text::before {
            content: "ü•É ";
            font-size: 1.2em;
            margin-right: 5px;
            color: var(--primary);
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.5;
            padding-left: 5px;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            text-align: left;
            transition: all 0.2s;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: var(--secondary);
        }

        .option-btn.correct {
            background-color: #d4efdf;
            border-color: var(--correct);
            color: var(--correct);
        }

        .option-btn.wrong {
            background-color: #fadbd8;
            border-color: var(--wrong);
            color: var(--wrong);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #ecf0f1;
            display: none;
        }

        /* Style pour les boutons g√©n√©raux */
        .action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }

        .action-btn:hover { background-color: #a04000; }
        
        .results-card {
            text-align: center;
        }
        
        .final-score {
            font-size: 3em;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* ------------------------------------------------------------------- */
        /* FIX MOBILE : Emp√™che le zoom sur le champ pseudo et ajuste les tailles */
        /* ------------------------------------------------------------------- */
        
        #pseudo-input {
            padding: 10px; 
            width: 80%; 
            margin-top: 15px; 
            border: 1px solid #ccc; 
            border-radius: 5px;
            font-size: 1em; /* Doit √™tre au moins 16px (1em) pour √©viter le zoom mobile */
            box-sizing: border-box;
        }

        @media (max-width: 640px) {
            .quiz-container {
                padding: 20px; /* Moins de padding sur mobile */
            }
            .welcome-title {
                font-size: 2em; /* R√©duction du titre pour l'espace */
            }
            .welcome-description {
                font-size: 1em; /* R√©duction du texte descriptif */
            }
        }
        
        /* Style pour le bouton d'envoi des r√©sultats */
        #send-results-btn {
            margin-top: 15px;
            background-color: var(--correct);
            border-color: var(--correct);
        }
        #send-results-btn:hover {
            background-color: #229954;
        }
        
        /* Style pour le bouton du Quiz Whisky (BRUN DE TONNEAU) */
        #quiz-whisky-btn {
            background-color: var(--barrel-brown) !important; 
            margin-bottom: 10px !important;
        }
        #quiz-whisky-btn:hover {
            background-color: var(--barrel-highlight) !important;
        }

    </style>
</head>
<body>

<div class="quiz-container">
    
    <div id="welcome-area">
        <h1 class="welcome-title">Quiz Rhum</h1>
        
        <!-- Affichage de l'image de la distillerie -->
        <img id="distillery-image-placeholder" class="distillery-image" alt="Illustration de distillerie de rhum et canne √† sucre">
        
        <p class="welcome-description">
            Avec Les Editions Spiritueuses, testez vos connaissances sur le rhum ! : Plongez dans son univers fascinant et d√©couvrez si vous √™tes un v√©ritable connaisseur de ce spiritueux l√©gendaire !
        </p>
        <p style="font-weight: bold; color: #CC7722; border: 1px dashed #CC7722; padding: 10px; margin-top: 20px;">
        ‚ö†Ô∏è R√àGLE DE SCORING : Le score final est pond√©r√© par le temps de r√©ponse. Le temps cible est de **2 minutes (120 secondes)**. Si vous d√©passez 2 minutes, votre Index de Performance sera l√©g√®rement p√©nalis√©.
    </p>
        <button class="action-btn" onclick="startQuiz()">Commencer le Quiz</button>
    </div>

    <div id="quiz-area" style="display:none;">
        <div class="header">
            <h1>Connaisseur du Rhum</h1>
            
            <!-- AFFICHAGE DE LA PROGRESSION (Question # et Chronom√®tre) -->
            <div class="progress-bar-container">
                <span id="question-progress-live" class="question-progress-live">Question 0 / 15</span> 
                <span id="chrono-live" class="chrono-live">00:00</span>
            </div>
        </div>

        <div class="question-card">
            <div class="question-meta">
                <span id="q-difficulty">Difficultit√©</span>
                <span id="q-points">Points</span>
            </div>
            <div class="question-text" id="question-text"></div>
            <div class="options-grid" id="options-container">
                </div>
        </div>

        <div class="feedback" id="feedback-area"></div>
        <button class="action-btn" id="next-btn" style="display:none" onclick="nextQuestion()">Question Suivante</button>
    </div>

    <div class="results-card" id="results-area" style="display:none;">
        <h2>Quiz Termin√© !</h2>
        
        <p style="font-size: 1.2em; color: var(--primary); font-weight: bold;">
            Pour voir les r√©sultats, renseignez votre pseudo :
        </p>

        <!-- Champ de pseudo sans style en ligne, utilisant le CSS #pseudo-input -->
        <input type="text" id="pseudo-input" placeholder="Votre Pseudo (requis)" 
            oninput="handlePseudoInput(this.value)"> 
        
        <!-- Bouton d'envoi des r√©sultats -->
        <button class="action-btn" id="send-results-btn" style="display:none;" onclick="sendResultFromButton()">
            Enregistrer mon r√©sultat
        </button>
        
        <div id="final-results-display" style="display:none;">
            
            <!-- Score brut X/30 -->
            <p id="raw-score-display" style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: var(--dark);"></p>

            <p id="time-taken-display" style="font-weight: bold; margin-bottom: 20px; color: var(--barrel-brown);"></p>
            
            <p>Votre **Index de Performance** est de :</p>
            <div class="final-score"><span id="final-score-val">0%</span></div>

            <p id="final-message"></p>
            
            <p id="send-status" style="font-weight: bold; color: var(--correct); margin-top: 10px;"></p>
        </div>

        <!-- Bouton vers le Quiz Whisky (Affich√© apr√®s envoi) -->
        <button class="action-btn" id="quiz-whisky-btn" style="display:none;" 
                onclick="window.open('https://les-editions-spiritueuses.github.io/quiz-whisky/', '_self')">
            Testez vos connaissances sur le whisky !
        </button>

        <button class="action-btn" style="background-color: #34495e;" onclick="location.reload()">Recommencer</button>
    </div>


<script>
    // -------------------------------------------------------------------
    // URL BRUTE (RAW) DE L'IMAGE GITHUB
    // -------------------------------------------------------------------
    const DISTILLERY_IMAGE_URL = "https://raw.githubusercontent.com/Les-Editions-Spiritueuses/quiz-rhum/main/distillerie-canne.jpg"; 

    // VOTRE URL DE DEPLOIEMENT GOOGLE APPS SCRIPT
    // REMPLACER cette cha√Æne par votre propre URL de d√©ploiement Google Apps Script !
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyvF0ZLV0GEm8RJkzZe_IOTUjitUd86IDbKSuV9f3qkBRWBxxlOT5TSaX6vROIQkcsS_w/exec";

    let resultSent = false; 
    let chronoInterval; // Pour stocker l'intervalle du chronom√®tre
    
    // Donn√©es du Quiz
    const quizData = [
        {
            q: "Quel √©l√©ment diff√©rencie le plus clairement un rhum agricole d‚Äôun rhum traditionnel ?",
            options: ["Le type de f√ªts utilis√©s", "Le climat de la distillerie", "La mati√®re premi√®re : vesou ou m√©lasse"],
            correct: 2,
            points: 1,
            explanation: "Le rhum agricole est fait √† partir de pur jus de canne (vesou), le traditionnel √† partir de m√©lasse."
        },
        {
            q: "Le vesou est :",
            options: ["Le jus de canne √† sucre frais press√©", "Un sirop de canne concentr√©", "Un distillat de m√©lasse"],
            correct: 0,
            points: 2,
            explanation: "Le vesou est le terme technique d√©signant le jus extrait directement du broyage de la canne."
        },
        {
            q: "La m√©lasse donne souvent des rhums :",
            options: ["Neutres et peu aromatiques", "Plus ronds, parfois gourmands", "L√©gers et floraux sans exception"],
            correct: 1,
            points: 3,
            explanation: "La m√©lasse, issue du sucre cuit, tend √† donner des notes de caramel et une certaine rondeur."
        },
        {
            q: "Quelle est l‚Äôune des cons√©quences d‚Äôune fermentation longue ?",
            options: ["Favorise les ar√¥mes complexes (fruit√©s/fermentaires)", "Donne un rhum tr√®s l√©ger", "R√©duit syst√©matiquement l'alcool"],
            correct: 0,
            points: 1,
            explanation: "Le temps permet aux levures de cr√©er des esters complexes et aromatiques."
        },
        {
            q: "Une fermentation courte donne g√©n√©ralement :",
            options: ["Des ar√¥mes lourds et √©pais", "Des rhums exclusivement vieillis", "Des rhums plus l√©gers et fruit√©s"],
            correct: 2,
            points: 2,
            explanation: "Une fermentation rapide limite les cong√©n√®res lourds pour un r√©sultat plus l√©ger."
        },
        {
            q: "Une fermentation longue permet surtout :",
            options: ["De r√©duire le taux d‚Äôalcool", "De d√©velopper des ar√¥mes complexes, riches en esters", "D‚Äôaromatiser avec des fruits"],
            correct: 1,
            points: 3,
            explanation: "C'est le secret des rhums 'Grand Ar√¥me' ou High Ester."
        },
        {
            q: "La distillation consiste principalement √† :",
            options: ["Sucrer le rhum", "S√©parer l‚Äôalcool de l‚Äôeau par chauffage", "Embouteiller le distillat"],
            correct: 1,
            points: 1,
            explanation: "C'est un proc√©d√© de s√©paration thermique bas√© sur les points d'√©bullition."
        },
        {
            q: "Le pot still est souvent associ√© √† :",
            options: ["Une distillation √† froid", "Des rhums tr√®s neutres", "Un style aromatique riche et puissant"],
            correct: 2,
            points: 2,
            explanation: "L'alambic √† repasse conserve plus d'√©l√©ments lourds et aromatiques que la colonne."
        },
        {
            q: "La distillation en colonne permet g√©n√©ralement :",
            options: ["Une production continue et optimis√©e", "Une production artisanale", "Un taux d'alcool faible"],
            correct: 0,
            points: 3,
            explanation: "C'est la m√©thode industrielle par excellence pour les grands volumes."
        },
        {
            q: "Quel climat acc√©l√®re le vieillissement d'un rhum ?",
            options: ["Tropical chaud et humide", "Sec et froid", "Alpin"],
            correct: 0,
            points: 1,
            explanation: "La chaleur dilate le bois et acc√©l√®re les r√©actions chimiques."
        },
        {
            q: "Un vieillissement en climat tropical a pour effet :",
            options: ["D‚Äôacc√©l√©rer la maturation et les ar√¥mes bois√©s", "De neutraliser le bois", "De r√©duire l'alcool drastiquement"],
            correct: 0,
            points: 2,
            explanation: "La 'part des anges' est √©lev√©e, concentrant le rhum et extrayant le bois rapidement."
        },
        {
            q: "Un rhum fini en f√ªt de Pedro Xim√©nez aura souvent :",
            options: ["Un profil sec et tannique", "Une texture saline", "Des notes liquoreuses, raisin sec et caramel"],
            correct: 2,
            points: 3,
            explanation: "Le f√ªt de ce vin doux l√®gue ses ar√¥mes sucr√©s et fruit√©s au rhum."
        },
        {
            q: "Quel est l‚Äôun des avantages de l‚Äôassemblage ?",
            options: ["Cr√©er un produit √©quilibr√© et complexe", "Augmenter la production sans distiller", "R√©duire le sucre"],
            correct: 0,
            points: 1,
            explanation: "L'assemblage permet d'harmoniser les profils et d'assurer la constance."
        },
        {
            q: "Un rhum 'mono-f√ªt' (Single Cask) :",
            options: ["Est un assemblage de 3 cuv√©es", "Vient d‚Äôun unique f√ªt", "Est un rhum brut sans distillation"],
            correct: 1,
            points: 2,
            explanation: "Comme son nom l'indique, il provient d'une seule barrique sp√©cifique."
        },
        {
            q: "La m√©thode Solera permet :",
            options: ["De produire un monoc√©page", "De filtrer via la canne", "Int√©grer en continu vieux et jeunes rhums"],
            correct: 2,
            points: 3,
            explanation: "C'est un syst√®me dynamique de m√©lange vertical pour homog√©n√©iser les √¢ges."
        }
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    const MAX_SCORE = 30; // Score max possible
    
    // Variables de temps
    let startTime;
    let timeTakenSeconds = 0;
    let performanceIndex = 0; 

    // √âl√©ments du DOM
    const welcomeArea = document.getElementById("welcome-area");
    const quizArea = document.getElementById("quiz-area");
    const resultsArea = document.getElementById("results-area");

    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const pointsDisplay = document.getElementById("q-points");
    const feedbackArea = document.getElementById("feedback-area");
    const nextBtn = document.getElementById("next-btn");
    
    // √âl√©ments de progression et d'image/bouton
    const questionProgressLive = document.getElementById("question-progress-live"); 
    const chronoLiveDisplay = document.getElementById("chrono-live");
    const sendResultsBtn = document.getElementById("send-results-btn");
    const distilleryImage = document.getElementById("distillery-image-placeholder");
    const quizWhiskyBtn = document.getElementById("quiz-whisky-btn"); // Nouveau bouton

    // Chargement de l'image de la distillerie au d√©marrage
    distilleryImage.src = DISTILLERY_IMAGE_URL;
    distilleryImage.onerror = function() {
        // Fallback si l'image GitHub ne charge pas
        this.src = "https://placehold.co/600x250/c0392b/ffffff?text=Erreur+de+chargement+Image+GitHub";
        console.error("L'image de la distillerie n'a pas pu √™tre charg√©e. V√©rifiez l'URL brute (Raw) GitHub.");
    };


    /**
     * Met √† jour le chronom√®tre affich√©.
     */
    function updateChrono() {
        const currentTime = new Date();
        timeTakenSeconds = Math.round((currentTime - startTime) / 1000); 
        const minutes = String(Math.floor(timeTakenSeconds / 60)).padStart(2, '0');
        const seconds = String(timeTakenSeconds % 60).padStart(2, '0');
        chronoLiveDisplay.textContent = `${minutes}:${seconds}`;
    }

    /**
     * Lance le quiz en cachant la page d'accueil et D√âMARRE LE CHRONOM√àTRE.
     */
    function startQuiz() {
        welcomeArea.style.display = "none";
        quizArea.style.display = "block";
        startTime = new Date(); // D√©marrage du chronom√®tre
        chronoInterval = setInterval(updateChrono, 1000); // Mise √† jour toutes les secondes
        loadQuestion();
    }

    function loadQuestion() {
        const currentData = quizData[currentQuestionIndex];
        
        questionText.textContent = currentData.q;
        pointsDisplay.textContent = currentData.points + (currentData.points > 1 ? " Points" : " Point");
        
        // MISE √Ä JOUR DU NUM√âRO DE QUESTION
        questionProgressLive.textContent = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;
        
        optionsContainer.innerHTML = "";
        feedbackArea.style.display = "none";
        nextBtn.style.display = "none";

        currentData.options.forEach((opt, index) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, btnElement) {
        const currentData = quizData[currentQuestionIndex];
        const buttons = optionsContainer.querySelectorAll(".option-btn");
        
        // D√©sactiver tous les boutons
        buttons.forEach(btn => btn.disabled = true);

        if (selectedIndex === currentData.correct) {
            btnElement.classList.add("correct");
            score += currentData.points;
            feedbackArea.innerHTML = `<strong>Correct !</strong> <br>${currentData.explanation}`;
            feedbackArea.style.borderLeft = "5px solid var(--correct)";
        } else {
            btnElement.classList.add("wrong");
            buttons[currentData.correct].classList.add("correct");
            feedbackArea.innerHTML = `<strong>Incorrect.</strong> La bonne r√©ponse √©tait : <em>${currentData.options[currentData.correct]}</em><br>${currentData.explanation}`;
            feedbackArea.style.borderLeft = "5px solid var(--wrong)";
        }

        feedbackArea.style.display = "block";
        nextBtn.style.display = "block";
        
        if (currentQuestionIndex === quizData.length - 1) {
            nextBtn.textContent = "Voir les r√©sultats";
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }


    /**
     * Affiche les r√©sultats, calcule le temps et l'Index de Performance
     */
    function showResults() {
        clearInterval(chronoInterval); // Arr√™ter le chronom√®tre
        quizArea.style.display = "none";
        resultsArea.style.display = "block";
        
        // On masque l'affichage des r√©sultats finaux en attendant que le pseudo soit renseign√©
        document.getElementById("final-results-display").style.display = "none";
        
        // --- 1. Calcul du temps √©coul√© ---
        const minutes = Math.floor(timeTakenSeconds / 60);
        const seconds = timeTakenSeconds % 60;
        const timeDisplay = `${minutes} min ${seconds} sec`;

        // --- 2. Calcul du Score Pond√©r√© (Index de Performance) ---
        const rawPercentage = (score / MAX_SCORE) * 100;
        
        const TARGET_TIME_SECONDS = 120; // Temps cible: 2 minutes (120 secondes)
        
        let timeFactor = 1;
        if (timeTakenSeconds > TARGET_TIME_SECONDS) {
            // Malus : 0.1% de malus par seconde au-del√† du temps cible
            timeFactor = 1 - ((timeTakenSeconds - TARGET_TIME_SECONDS) * 0.001);
            timeFactor = Math.max(0.5, timeFactor); // Limite du malus √† 50%
        }

        // On stocke le r√©sultat dans la variable globale pour l'envoi
        performanceIndex = Math.round(rawPercentage * timeFactor);
        performanceIndex = Math.max(0, Math.min(100, performanceIndex));


        // --- 3. Mise √† jour des valeurs de l'√©cran de r√©sultats ---
        document.getElementById("final-score-val").textContent = performanceIndex + "%"; 
        
        // Afficher le score brut (X/30)
        document.getElementById("raw-score-display").textContent = `Score brut : ${score} / ${MAX_SCORE} Points`;

        document.getElementById("time-taken-display").textContent = `Dur√©e totale : ${timeDisplay}`;


        const msg = document.getElementById("final-message");
        if (performanceIndex === 100) {
            msg.textContent = "F√©licitations ! Vous √™tes un Ma√Ætre du Rhum avec une rapidit√© impressionnante ! ü•É";
        } else if (performanceIndex >= 75) {
            msg.textContent = "Index de Performance Excellent ! Votre connaissance et votre rapidit√© sont au top.";
        } else if (performanceIndex >= 35) {
            msg.textContent = "Index Correct. Vous avez de bonnes bases, mais tentez d'√™tre plus rapide la prochaine fois !";
        } else {
            msg.textContent = "C'est un d√©but. Acc√©l√©rez le rythme !";
        }
        
        // Initialiser le statut d'envoi
        document.getElementById('send-status').textContent = "Statut : Pr√™t √† envoyer.";
        
        // S'assurer que le bouton Whisky est cach√© au chargement des r√©sultats
        quizWhiskyBtn.style.display = 'none';
    }
    
    // -------------------------------------------------------------------
    // FONCTION POUR ENVOYER LES R√âSULTATS (Avec Exponential Backoff)
    // -------------------------------------------------------------------
    async function sendResult(pseudo) {
        if (resultSent) return; 

        document.getElementById('send-status').textContent = "Envoi des r√©sultats en cours...";
        
        // Afficher d'abord les r√©sultats calcul√©s si ce n'est pas fait
        document.getElementById("final-results-display").style.display = "block";

        const dataToSend = {
            pseudo: pseudo,
            score: score,                  
            time: timeTakenSeconds,        
            performanceIndex: performanceIndex 
        };
        
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        const maxRetries = 3;
        let attempt = 0;
        let success = false;

        while (attempt < maxRetries && !success) {
            try {
                // Tentative d'envoi √† Google Apps Script
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', // N√©cessaire pour les appels cross-origin simples
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSend)
                });

                // Si le fetch r√©ussit sans erreur r√©seau (m√™me si la r√©ponse est opaque), on consid√®re que l'envoi a √©t√© tent√©.
                success = true;
                resultSent = true;
                document.getElementById('send-status').textContent = "‚úÖ R√©sultat enregistr√© !";
                sendResultsBtn.disabled = true; // D√©sactiver le bouton apr√®s l'envoi
                
                // NOUVEAU : Afficher le bouton vers le quiz Whisky
                quizWhiskyBtn.style.display = 'block'; 

            } catch (error) {
                attempt++;
                if (attempt < maxRetries) {
                    const waitTime = Math.pow(2, attempt) * 1000; 
                    // Pas de log d'erreur ici pour l'exponential backoff (consigne)
                    await delay(waitTime);
                } else {
                    console.error("Erreur lors de l'envoi des donn√©es √† Google Sheets (apr√®s plusieurs tentatives):", error);
                    document.getElementById('send-status').textContent = "‚ùå √âchec de l'enregistrement. V√©rifiez l'URL et les logs du script.";
                    resultSent = false;
                }
            }
        }
    }

    // -------------------------------------------------------------------
    // GESTION DE LA SAISIE DU PSEUDO (Afficher le bouton d'envoi)
    // -------------------------------------------------------------------

    function handlePseudoInput(pseudoValue) {
        const pseudoTrimmed = pseudoValue.trim();
        
        // Afficher ou masquer le bouton d'envoi en fonction de la saisie
        if (pseudoTrimmed.length > 0) {
            sendResultsBtn.style.display = "block";
        } else {
            sendResultsBtn.style.display = "none";
        }
        
        // Si le pseudo change APR√àS l'envoi initial, on permet de renvoyer (optionnel)
        if (resultSent) {
            resultSent = false;
            document.getElementById('send-status').textContent = "Statut : Pr√™t √† envoyer de nouveau.";
            sendResultsBtn.disabled = false;
            quizWhiskyBtn.style.display = 'none'; // Cacher le bouton s'il y a un changement
        }
    }
    
    // -------------------------------------------------------------------
    // GESTION DU CLIC SUR LE BOUTON D'ENVOI
    // -------------------------------------------------------------------
    
    function sendResultFromButton() {
        const pseudoInput = document.getElementById('pseudo-input');
        const pseudo = pseudoInput.value.trim();

        if (pseudo.length > 0) {
            sendResult(pseudo);
        } else {
            document.getElementById('send-status').textContent = "Veuillez entrer un pseudo valide.";
            pseudoInput.focus();
        }
    }
</script>

</body>
</html>
